<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sci_testbench_alt: E:/Users/Eric/Documents/Senior Design/sci_testbench_alt/sci_api.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sci_testbench_alt
   </div>
   <div id="projectbrief">Test/Demo SCI comms for Flywheel</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sci__api_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sci_api.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>API Function Calls.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="sci__api_8h_source.html">sci_api.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="77_d__sci_8h_source.html">77D_sci.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac208f7e7c011ec887ca3ec03b241941f"><td class="memItemLeft" align="right" valign="top"><a id="ac208f7e7c011ec887ca3ec03b241941f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#ac208f7e7c011ec887ca3ec03b241941f">init_params</a> (struct <a class="el" href="structparams.html">params</a> *values)</td></tr>
<tr class="memdesc:ac208f7e7c011ec887ca3ec03b241941f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accepts a pointer to a params struct and sets all values to 0. Change as needed to set to the desired default values. 0 seemed like a safe bet. <br /></td></tr>
<tr class="separator:ac208f7e7c011ec887ca3ec03b241941f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73760ed076a8b339bbe017196373d71d"><td class="memItemLeft" align="right" valign="top"><a id="a73760ed076a8b339bbe017196373d71d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#a73760ed076a8b339bbe017196373d71d">extract_cmd</a> (char extracted[4])</td></tr>
<tr class="memdesc:a73760ed076a8b339bbe017196373d71d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Not currently in use. Was meant to extract the data from a packet, see <a class="el" href="sci__api_8c.html#a17115cd37a42375bb9b191e4db34aa43" title="Convert packet to a float Accepts the 6 element data packet and extracts the 4 data bytes Assembles t...">assemble()</a> for current solution. <br /></td></tr>
<tr class="separator:a73760ed076a8b339bbe017196373d71d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaef3768b23b03ec91379590828051b6d"><td class="memItemLeft" align="right" valign="top"><a id="aaef3768b23b03ec91379590828051b6d"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#aaef3768b23b03ec91379590828051b6d">parse_cmd</a> (char *extracted, struct <a class="el" href="structparams.html">params</a> *set_point)</td></tr>
<tr class="memdesc:aaef3768b23b03ec91379590828051b6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses packet and updates operating point. Pass a pointer to the current command packet and a pointer to the set point struct. Uses <a class="el" href="sci__api_8c.html#a17115cd37a42375bb9b191e4db34aa43" title="Convert packet to a float Accepts the 6 element data packet and extracts the 4 data bytes Assembles t...">assemble()</a> to extract the data and assign it to the relevant value. <br /></td></tr>
<tr class="separator:aaef3768b23b03ec91379590828051b6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9832bac010cccef92f1ebb6755f6ffa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#ae9832bac010cccef92f1ebb6755f6ffa">e_stop</a> (struct <a class="el" href="structparams.html">params</a> *set_point)</td></tr>
<tr class="memdesc:ae9832bac010cccef92f1ebb6755f6ffa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiate an emergency stop. Upon receipt of an emergency stop, set the set point velocity to 0 and the acceleration and jerk to their maximum safe value. These safe values are defined in <a class="el" href="sci__api_8h.html" title="API Prototypes and Macros. ">sci_api.h</a> and must currently be configured at compile time.  <a href="#ae9832bac010cccef92f1ebb6755f6ffa">More...</a><br /></td></tr>
<tr class="separator:ae9832bac010cccef92f1ebb6755f6ffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a627f6bcfacca0e2fc1eef64883c69c3e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#a627f6bcfacca0e2fc1eef64883c69c3e">send_value</a> (char IDM, float val, char CDM)</td></tr>
<tr class="memdesc:a627f6bcfacca0e2fc1eef64883c69c3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a packet to the GUI Accepts the IDM, value, and CDM. In the event the transmission protocol changes (e.g. USB, Ethernet), this will need to be updated.  <a href="#a627f6bcfacca0e2fc1eef64883c69c3e">More...</a><br /></td></tr>
<tr class="separator:a627f6bcfacca0e2fc1eef64883c69c3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b8965bce76bcbcd9726e7ef30ea4636"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#a3b8965bce76bcbcd9726e7ef30ea4636">broadcast</a> (int enable, struct <a class="el" href="structparams.html">params</a> values)</td></tr>
<tr class="memdesc:a3b8965bce76bcbcd9726e7ef30ea4636"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcasts current operating point information Currently accepts and enable value that isn't in use and the operating point structure.  <a href="#a3b8965bce76bcbcd9726e7ef30ea4636">More...</a><br /></td></tr>
<tr class="separator:a3b8965bce76bcbcd9726e7ef30ea4636"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1aa642c19a64bcbfdd89d0903360640b"><td class="memItemLeft" align="right" valign="top"><a id="a1aa642c19a64bcbfdd89d0903360640b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#a1aa642c19a64bcbfdd89d0903360640b">broadcast_ctrl</a> (int enable)</td></tr>
<tr class="memdesc:a1aa642c19a64bcbfdd89d0903360640b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Not currently in use. Was to enable/disable broadcasting of data. <br /></td></tr>
<tr class="separator:a1aa642c19a64bcbfdd89d0903360640b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba7de291e35b3d2be08582b1f6f0a961"><td class="memItemLeft" align="right" valign="top"><a id="aba7de291e35b3d2be08582b1f6f0a961"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#aba7de291e35b3d2be08582b1f6f0a961">send_error</a> (Uint16 error)</td></tr>
<tr class="memdesc:aba7de291e35b3d2be08582b1f6f0a961"><td class="mdescLeft">&#160;</td><td class="mdescRight">Not currently in use If an error code is needed, send it here. Should probably just call <a class="el" href="sci__api_8c.html#a627f6bcfacca0e2fc1eef64883c69c3e" title="Sends a packet to the GUI Accepts the IDM, value, and CDM. In the event the transmission protocol cha...">send_value()</a> with the error code. <br /></td></tr>
<tr class="separator:aba7de291e35b3d2be08582b1f6f0a961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17115cd37a42375bb9b191e4db34aa43"><td class="memItemLeft" align="right" valign="top"><a id="a17115cd37a42375bb9b191e4db34aa43"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sci__api_8c.html#a17115cd37a42375bb9b191e4db34aa43">assemble</a> (char data[6])</td></tr>
<tr class="memdesc:a17115cd37a42375bb9b191e4db34aa43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert packet to a float Accepts the 6 element data packet and extracts the 4 data bytes Assembles those bytes into a float value through the use of a union. Probably could be improved stylistically through the use of bitfields. <br /></td></tr>
<tr class="separator:a17115cd37a42375bb9b191e4db34aa43"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>API Function Calls. </p>
<p>These functions implement the desired reception, transmission, encoding, and decoding of packets described in the Flywheel API.</p>
<dl class="section date"><dt>Date</dt><dd>8 Dec 2016 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Eric Silk </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3b8965bce76bcbcd9726e7ef30ea4636"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b8965bce76bcbcd9726e7ef30ea4636">&sect;&nbsp;</a></span>broadcast()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int broadcast </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>enable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structparams.html">params</a>&#160;</td>
          <td class="paramname"><em>values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Broadcasts current operating point information Currently accepts and enable value that isn't in use and the operating point structure. </p>
<p>Currently very slow. It must wait until the lasat packet is fully transmitted before sending the next, and must transmit all packets before returning. Consider using the SCIA TX interrupt and developing an ISR for less time in the function and greater throughput. For instance, set the interrupt to fire anytime there are fewer than 8 elements in the FIFO and stuff the next packet in before returning. Use a software FSM to track the next packet that needs transmission (preferably using an enumerated type to restrict behavior).</p>
<p>Google it if you don't know what I'm talking about. </p>

</div>
</div>
<a id="ae9832bac010cccef92f1ebb6755f6ffa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9832bac010cccef92f1ebb6755f6ffa">&sect;&nbsp;</a></span>e_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int e_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structparams.html">params</a> *&#160;</td>
          <td class="paramname"><em>set_point</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiate an emergency stop. Upon receipt of an emergency stop, set the set point velocity to 0 and the acceleration and jerk to their maximum safe value. These safe values are defined in <a class="el" href="sci__api_8h.html" title="API Prototypes and Macros. ">sci_api.h</a> and must currently be configured at compile time. </p>
<p>The GUI expects an ACK, so it also sends the relevant code up.</p>
<p>Possible improvements would be accepting SAFE_DECEL and SAFE_JERK arguments so that the operator can set those, but this could lead to undesirable behavior during operation. Additionally, some form of error checking if needed and an appropriate return value as needed. </p>

</div>
</div>
<a id="a627f6bcfacca0e2fc1eef64883c69c3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a627f6bcfacca0e2fc1eef64883c69c3e">&sect;&nbsp;</a></span>send_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_value </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>IDM</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>CDM</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a packet to the GUI Accepts the IDM, value, and CDM. In the event the transmission protocol changes (e.g. USB, Ethernet), this will need to be updated. </p>
<p>Possible improvements would be checking the IDM/CDM pair or only accepting one and filling in the other, and enforcing some form of error checking with an appropriate return value. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d522931ffa1371640980b621734a4381.html">Users</a></li><li class="navelem"><a class="el" href="dir_bc2b495b0e4df4e04327641d0b1e06ea.html">Eric</a></li><li class="navelem"><a class="el" href="dir_379f84063da30960665de23f039348c5.html">Documents</a></li><li class="navelem"><a class="el" href="dir_543f65e2545515c411c95ea835949ae2.html">Senior Design</a></li><li class="navelem"><a class="el" href="dir_7aec45049981907fbf9d7c3c02dfc39b.html">sci_testbench_alt</a></li><li class="navelem"><a class="el" href="sci__api_8c.html">sci_api.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
